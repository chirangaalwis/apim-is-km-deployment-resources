# Copyright (c) 2021, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "am-pattern-3.resource.prefix" . }}-mi-conf
  namespace : {{ .Release.Namespace }}
data:
  deployment.toml: |-
    [server]
    hostname = "localhost"
    # offset  = 10

    [user_store]
    type = "read_only_ldap"

    [keystore.primary]
    file_name = "repository/resources/security/primary-keystore.jks"
    alias = {{ .Values.wso2.deployment.mi.customConfig.cryptography.keyStores.primary.alias | quote }}
    password = {{ .Values.wso2.deployment.mi.customConfig.cryptography.keyStores.primary.password | quote }}
    key_password = {{ .Values.wso2.deployment.mi.customConfig.cryptography.keyStores.primary.password | quote }}

    [keystore.internal]
    file_name = "repository/resources/security/internal-keystore.jks"
    alias = {{ .Values.wso2.deployment.mi.customConfig.cryptography.keyStores.internal.alias | quote }}
    password = {{ .Values.wso2.deployment.mi.customConfig.cryptography.keyStores.internal.password | quote }}
    key_password = {{ .Values.wso2.deployment.mi.customConfig.cryptography.keyStores.internal.password | quote }}

    [truststore]
    file_name = "repository/resources/security/client-truststore.jks"
    password = {{ .Values.wso2.deployment.mi.customConfig.cryptography.trustStorePassword | quote }}
    alias = "symmetric.key.value"
    algorithm = "AES"

    [transport.http.listener.keystore]
    location = "repository/resources/security/secondary-keystore.jks"
    password = {{ .Values.wso2.deployment.mi.customConfig.cryptography.keyStores.secondary.password | quote }}
    key_password = {{ .Values.wso2.deployment.mi.customConfig.cryptography.keyStores.secondary.password | quote }}

    [transport.http.sender.keystore]
    location = "repository/resources/security/secondary-keystore.jks"
    password = {{ .Values.wso2.deployment.mi.customConfig.cryptography.keyStores.secondary.password | quote }}
    key_password = {{ .Values.wso2.deployment.mi.customConfig.cryptography.keyStores.secondary.password | quote }}

    [internal_api_ssl_config.key_store]
    location = "repository/resources/security/secondary-keystore.jks"
    password = {{ .Values.wso2.deployment.mi.customConfig.cryptography.keyStores.secondary.password | quote }}
    key_password = {{ .Values.wso2.deployment.mi.customConfig.cryptography.keyStores.secondary.password | quote }}

    ## Following are set of example configs. Please refer docs for complete set of configurations.

    # [transport.http]
    # socket_timeout = 180000   # timeout in milliseconds
    # disable_connection_keepalive = false
    # connection_timeout = 90000 # in milliseconds

    # [transport.jms]
    # sender_enable = true
    # listener_enable = true

    # [[transport.jms.sender]]
    # name = "myQueueSender"
    # parameter.initial_naming_factory = "org.apache.activemq.jndi.ActiveMQInitialContextFactory"
    # parameter.provider_url = "tcp://localhost:61616"
    # parameter.connection_factory_name = "QueueConnectionFactory"
    # parameter.connection_factory_type = "queue"
    # parameter.cache_level = "producer"


    #[[transport.jms.listener]]
    # name = "myQueueConnectionFactory"
    # parameter.initial_naming_factory = "org.apache.activemq.jndi.ActiveMQInitialContextFactory"
    # parameter.provider_url = "tcp://localhost:61616"
    # parameter.connection_factory_name = "QueueConnectionFactory"
    # parameter.connection_factory_type = "queue"

    # [transport.jndi.connection_factories]
    # 'connectionfactory.QueueConnectionFactory' = "amqp://admin:admin@clientID/carbon?brokerlist='tcp://localhost:5675'"
    # 'connectionfactory.TopicConnectionFactory' = "amqp://admin:admin@clientID/carbon?brokerlist='tcp://localhost:5675'"

    # [transport.jndi.queue]
    # jndiNameOfQueue = "physicalNameOfQueue"

    # [transport.jndi.topic]
    # jndiNameOfTopic = "physicalNameOfTopic"

    # [transport.rabbitmq]
    # sender_enable = true
    # listener_enable = true

    # [[transport.rabbitmq.sender]]
    # name = "AMQPConnectionFactory"
    # parameter.hostname = "localhost"
    # parameter.port = 5672
    # parameter.username = "guest"
    # parameter.password = "guest"

    # [[transport.rabbitmq.listener]]
    # name = "AMQPConnectionFactory"
    # parameter.hostname = "localhost"
    # parameter.port = 5672
    # parameter.username = "guest"
    # parameter.password = "guest"

    # [system.parameter]
    # 'key' = "value"

    # [[datasource]]
    # id = "WSO2CarbonDB"  # "WSO2_COORDINATION_DB"
    # url = "jdbc:mysql://localhost:3306/integratordb"
    # username = "root"
    # password = "root"
    # driver = "com.mysql.jdbc.Driver"

    # [management_api]
    # protocols = "http"

    # [[internal_apis.users]]
    # user.name = "user-1"
    # user.password = "pwd-1"

    # [transaction_counter]
    # enable = true
    # data_source = "WSO2CarbonDB"
    # update_interval = 2

    # [mediation]
    # synapse.global_timeout_interval = "120000"  # interval in milliseconds

    # [secrets]
    # secret_key = "[secret value]"

    # [[service_catalog]]
    # apim_host = "https://localhost:9443"
    # enable = true
    # username = "admin"
    # password = "admin"
